/**
 * カテゴリ自動分類
 *
 * キーワードベースで説明文からカテゴリを推定。
 * 収入か支出かも自動判定する。
 */

// 収入キーワード → これに一致したら type: 'income'
const INCOME_KEYWORDS = [
    "給料",
    "給与",
    "ボーナス",
    "賞与",
    "副業",
    "報酬",
    "売上",
    "入金",
    "還付",
    "キャッシュバック",
    "お小遣い",
    "仕送り",
    "配当",
    "利息",
    "バイト",
    "アルバイト",
];

// カテゴリ分類用キーワードマップ
const CATEGORY_KEYWORDS = {
    食費: [
        "ランチ",
        "昼食",
        "朝食",
        "夕食",
        "晩御飯",
        "ご飯",
        "食事",
        "外食",
        "スーパー",
        "コンビニ",
        "弁当",
        "レストラン",
        "カフェ",
        "居酒屋",
        "ファミレス",
        "牛丼",
        "ラーメン",
        "寿司",
        "ピザ",
        "マック",
        "マクドナルド",
        "スタバ",
        "デリバリー",
        "UberEats",
        "出前",
    ],
    交通費: [
        "電車",
        "バス",
        "タクシー",
        "定期",
        "切符",
        "Suica",
        "PASMO",
        "ICOCA",
        "新幹線",
        "飛行機",
        "航空券",
        "高速",
        "駐車",
        "ガソリン",
        "燃料",
    ],
    住居費: ["家賃", "管理費", "共益費", "更新料", "敷金", "礼金", "住宅ローン"],
    光熱費: ["電気", "ガス", "水道", "灯油", "エネルギー"],
    通信費: [
        "スマホ",
        "携帯",
        "WiFi",
        "ネット",
        "プロバイダ",
        "回線",
        "SIM",
        "通信",
        "電話",
    ],
    日用品: [
        "日用品",
        "洗剤",
        "シャンプー",
        "トイレットペーパー",
        "ティッシュ",
        "掃除",
        "雑貨",
        "100均",
        "ダイソー",
        "ドラッグストア",
        "薬局",
    ],
    医療費: [
        "病院",
        "医者",
        "歯医者",
        "薬",
        "処方",
        "診察",
        "治療",
        "健康診断",
        "整体",
        "マッサージ",
    ],
    衣服: ["服", "靴", "衣類", "クリーニング", "ユニクロ", "GU", "ZARA"],
    娯楽: [
        "映画",
        "ゲーム",
        "本",
        "書籍",
        "漫画",
        "Netflix",
        "サブスク",
        "趣味",
        "旅行",
        "ホテル",
        "温泉",
        "ジム",
        "スポーツ",
        "ライブ",
        "コンサート",
        "遊び",
    ],
    教育: ["学費", "教材", "塾", "習い事", "セミナー", "資格", "受験", "参考書"],
    保険: ["保険", "生命保険", "医療保険", "自動車保険", "火災保険", "年金"],
    税金: ["税金", "所得税", "住民税", "固定資産税", "自動車税", "ふるさと納税"],
    交際費: [
        "飲み会",
        "プレゼント",
        "お祝い",
        "ご祝儀",
        "香典",
        "お土産",
        "付き合い",
    ],
};

/**
 * 説明文が収入かどうか判定
 * @param {string} description
 * @returns {boolean}
 */
function isIncome(description) {
    return INCOME_KEYWORDS.some((kw) => description.includes(kw));
}

/**
 * 説明文からカテゴリを推定
 * @param {string} description
 * @param {'income' | 'expense'} type
 * @returns {string}
 */
function classifyCategory(description, type) {
    if (type === "income") {
        return "収入";
    }

    for (const [category, keywords] of Object.entries(CATEGORY_KEYWORDS)) {
        if (keywords.some((kw) => description.includes(kw))) {
            return category;
        }
    }

    return "その他";
}

module.exports = { isIncome, classifyCategory, INCOME_KEYWORDS, CATEGORY_KEYWORDS };
